{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Internship Application</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>Internship Application Form</h1>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <!-- Personal Information -->
                <div class="form-section">
                    <h2>Personal Information</h2>
                    <div class="form-row grid-3-col">
                        <div class="form-group">
                            <label for="firstname">First Name:</label>
                            <input type="text" id="firstname" name="firstname" required />
                        </div>
                        <div class="form-group">
                            <label for="middlename">Middle Name (Optional):</label>
                            <input type="text" id="middlename" name="middlename" />
                        </div>
                        <div class="form-group">
                            <label for="lastname">Last Name:</label>
                            <input type="text" id="lastname" name="lastname" required />
                        </div>
                    </div>
                    <div class="form-row grid-2-col">
                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" id="email" name="email" required />
                        </div>
                        <div class="form-group">
                            <label for="phone_number">Phone Number:</label>
                            <input type="tel" id="phone_number" name="phone_number" required />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="address">Address:</label>
                        <textarea id="address" name="address" rows="3" required></textarea>
                    </div>
                    <div class="form-row grid-2-col">
                        <div class="form-group">
                            <label for="birthdate">Birthdate:</label>
                            <input type="date" id="birthdate" name="birthdate" required />
                        </div>
                        <div class="form-group">
                            <label for="gender_type">Gender:</label>
                            <select id="gender_type" name="gender_type" required>
                                <option value="">Select Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Academic Information -->
                <div class="form-section">
                    <h2>Academic Information</h2>
                    <div class="form-row grid-3-col">
                        <div class="form-group">
                            <label for="school">School:</label>
                            <input type="text" id="school" name="school" required />
                        </div>
                        <div class="form-group">
                            <label for="course">Course:</label>
                            <input type="text" id="course" name="course" required />
                        </div>
                        <div class="form-group">
                            <label for="year">Year Level:</label>
                            <input type="number" id="year" name="year" min="1" required />
                        </div>
                    </div>
                </div>

                <!-- Internship Details -->
                <div class="form-section">
                    <h2>Internship Details</h2>
                    <div class="form-group">
                        <label for="internship_position">Desired Internship Position:</label>
                        <select id="internship_position" name="internship_position" required>
                            <option value="">-- Select a position --</option>
                            <option value="Computer Science / IT Intern">Computer Science / IT Intern</option>
                            <option value="Journalism Intern">Journalism Intern</option>
                            <option value="Marketing and Communication Intern">Marketing and Communication Intern</option>
                            <option value="Multimedia Arts Intern">Multimedia Arts Intern</option>
                            <option value="Research Intern">Research Intern</option>
                            <option value="Statistics Intern">Statistics Intern</option>
                        </select>
                    </div>
                    <div class="form-row grid-2-col">
                        <div class="form-group">
                            <label for="internship_type">Internship Type:</label>
                            <select id="internship_type" name="internship_type" required>
                                <option value="">Select Type</option>
                                <option value="Academic">Academic</option>
                                <option value="Voluntary">Voluntary</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="required_hrs">Required Hours:</label>
                            <input type="number" id="required_hrs" name="required_hrs" min="1" required />
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Upload Resume:</label>
                        <div class="file-upload-area" id="file-drop-zone">
                            <input
                              type="file"
                              id="resume_file_name"
                              name="resume_file_name"
                              accept=".pdf,.doc,.docx"
                              required
                              hidden
                            />
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p id="file-upload-text">Drag and drop file here or click to upload</p>
                        </div>
                    </div>
                </div>

                <!-- Consent -->
                <div class="checkbox" style="text-align: left;">
                    <label for="consent">
                        <input type="checkbox" id="consent" name="consent" required />
                        I agree to the <a href="#">terms and conditions</a>.
                    </label>
                </div>

                <button type="submit" class="submit-btn">Submit Application</button>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    {% if show_success_modal %}
    <div id="successModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <i class="fas fa-check-circle success-icon"></i>
            <h2>Application Submitted!</h2>
            <p>Your internship application has been successfully submitted. We will review it and get back to you soon.</p>
            <button class="ok-button">OK</button>
        </div>
    </div>
    {% endif %}

    <!-- Error Modal -->
    {% if error_message %}
    <div id="errorModal" class="modal">
        <div class="modal-content error">
            <span class="close-button" id="closeErrorModal">&times;</span>
            <i class="fas fa-exclamation-triangle" style="color: #d9534f; font-size: 2rem;"></i>
            <h2 style="color: #d9534f;">Email Already Exists</h2>
            <p>{{ error_message }}</p>
            <button class="ok-button" id="acknowledgeErrorBtn">OK</button>
        </div>
    </div>
    {% endif %}

    <!-- JavaScript -->
    <script>
document.addEventListener('DOMContentLoaded', function () {
    // Success Modal
    const successModal = document.getElementById('successModal');
    const successCloseBtn = successModal?.querySelector('.close-button');
    const successOkBtn = successModal?.querySelector('.ok-button');

    if (successModal) {
        successModal.style.display = 'flex';
    }

    function closeSuccessModal() {
        successModal.style.display = 'none';
        if (window.history.replaceState) {
            const url = new URL(window.location);
            url.searchParams.delete('success');
            window.history.replaceState({}, document.title, url.toString());
        }
    }

    successCloseBtn?.addEventListener('click', closeSuccessModal);
    successOkBtn?.addEventListener('click', closeSuccessModal);
    window.addEventListener('click', (event) => {
        if (event.target === successModal) {
            closeSuccessModal();
        }
    });

    // Error Modal
    const errorModal = document.getElementById('errorModal');
    const errorCloseBtn = document.getElementById('closeErrorModal');
    const errorOkBtn = document.getElementById('acknowledgeErrorBtn');

    if (errorModal) {
        errorModal.style.display = 'flex';
    }

    function closeErrorModal() {
        errorModal.style.display = 'none';
    }

    errorCloseBtn?.addEventListener('click', closeErrorModal);
    errorOkBtn?.addEventListener('click', closeErrorModal);
    window.addEventListener('click', (event) => {
        if (event.target === errorModal) {
            closeErrorModal();
        }
    });

    // Consent Checkbox
    document.querySelector('form').addEventListener('submit', function (event) {
        const consentCheckbox = document.getElementById('consent');
        if (!consentCheckbox.checked) {
            event.preventDefault();
            alert('Please agree to the terms and conditions before submitting.');
            consentCheckbox.focus();
        }
    });

    // File Upload UI with Validation
    const dropZone = document.getElementById('file-drop-zone');
    const fileInput = document.getElementById('resume_file_name');
    const uploadText = document.getElementById('file-upload-text');
    const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB

    function validateFile(file) {
        const fileName = file.name;
        const fileSize = file.size;
        const fileExtension = fileName.split('.').pop().toLowerCase();

        if (fileExtension !== 'pdf') {
            alert('Only PDF files are allowed.');
            fileInput.value = '';
            uploadText.textContent = 'Drag and drop file here or click to upload';
            return false;
        }

        if (fileSize > MAX_FILE_SIZE) {
            alert('File must be 5MB or less.');
            fileInput.value = '';
            uploadText.textContent = 'Drag and drop file here or click to upload';
            return false;
        }

        uploadText.textContent = fileName;
        return true;
    }

    dropZone?.addEventListener('click', () => fileInput.click());

    fileInput?.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            validateFile(fileInput.files[0]);
        }
    });

    dropZone?.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('active');
    });

    dropZone?.addEventListener('dragleave', () => {
        dropZone.classList.remove('active');
    });

    dropZone?.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('active');

        const file = e.dataTransfer.files[0];
        if (validateFile(file)) {
            fileInput.files = e.dataTransfer.files;
        }
    });
});
</script>

</body>
</html>

